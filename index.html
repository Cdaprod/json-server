<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GitHub-Integrated Specialized Mock API</title>
    <script src="https://unpkg.com/react@17/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@17/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; margin: 0; padding: 20px; }
        #root { max-width: 800px; margin: 0 auto; }
        select, textarea, button { margin: 10px 0; padding: 5px; width: 100%; }
        button { background-color: #4CAF50; color: white; border: none; padding: 10px; cursor: pointer; }
        .error { color: red; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // Mock API using localStorage
        const MockAPI = {
            getData: (route) => {
                return JSON.parse(localStorage.getItem(route) || '[]');
            },
            setData: (route, data) => {
                localStorage.setItem(route, JSON.stringify(data));
            },
            getRoutes: () => {
                return ['buckets', 'ai-tools', 'repo-modules', 'gitignore-files'];
            },
            initializeData: () => {
                if (!localStorage.getItem('buckets')) {
                    MockAPI.setData('buckets', [
                        { id: 1, name: "Data Bucket", description: "For storing raw data" },
                        { id: 2, name: "Analytics Bucket", description: "For storing analytics results" }
                    ]);
                }
                if (!localStorage.getItem('ai-tools')) {
                    MockAPI.setData('ai-tools', [
                        { id: 1, name: "Text Classifier", description: "AI tool for text classification" },
                        { id: 2, name: "Image Recognizer", description: "AI tool for image recognition" }
                    ]);
                }
                if (!localStorage.getItem('repo-modules')) {
                    MockAPI.setData('repo-modules', [
                        { 
                            id: 1, 
                            repoName: "data-processor", 
                            image: "data-processor-image",
                            tag: "v1.0",
                            url: "https://github.com/example/data-processor",
                            registry: "docker.io",
                            pluginName: "Data Processor Plugin"
                        },
                        { 
                            id: 2, 
                            repoName: "ai-model-trainer", 
                            image: "ai-trainer-image",
                            tag: "v2.1",
                            url: "https://github.com/example/ai-model-trainer",
                            registry: "gcr.io",
                            pluginName: "AI Model Trainer Plugin"
                        }
                    ]);
                }
            }
        };

        async function fetchGitignoreFiles() {
            try {
                const response = await fetch('https://api.github.com/users/Cdaprod/repos?sort=created&direction=desc&per_page=10');
                const repos = await response.json();
                
                const gitignoreFiles = await Promise.all(repos.map(async (repo) => {
                    try {
                        const gitignoreResponse = await fetch(`https://api.github.com/repos/Cdaprod/${repo.name}/contents/.gitignore`);
                        if (gitignoreResponse.status === 200) {
                            const gitignoreData = await gitignoreResponse.json();
                            const content = atob(gitignoreData.content);
                            return { repoName: repo.name, content };
                        }
                    } catch (error) {
                        console.error(`Error fetching .gitignore for ${repo.name}:`, error);
                    }
                    return null;
                }));

                return gitignoreFiles.filter(file => file !== null);
            } catch (error) {
                console.error("Error fetching repositories:", error);
                return [];
            }
        }

        function App() {
            const [routes] = useState(MockAPI.getRoutes());
            const [selectedRoute, setSelectedRoute] = useState('');
            const [data, setData] = useState('');
            const [error, setError] = useState(null);

            useEffect(() => {
                MockAPI.initializeData();
            }, []);

            useEffect(() => {
                if (selectedRoute) {
                    if (selectedRoute === 'gitignore-files') {
                        fetchGitignoreFiles().then(files => {
                            MockAPI.setData('gitignore-files', files);
                            setData(JSON.stringify(files, null, 2));
                        });
                    } else {
                        setData(JSON.stringify(MockAPI.getData(selectedRoute), null, 2));
                    }
                }
            }, [selectedRoute]);

            const handleSave = () => {
                try {
                    const parsedData = JSON.parse(data);
                    MockAPI.setData(selectedRoute, parsedData);
                    alert('Data saved successfully!');
                    setError(null);
                } catch (e) {
                    console.error("Error saving data:", e);
                    setError("Failed to save data. Ensure it's valid JSON.");
                }
            };

            return (
                <div>
                    <h1>GitHub-Integrated Specialized Mock API</h1>
                    {error && <div className="error">{error}</div>}
                    <select value={selectedRoute} onChange={(e) => setSelectedRoute(e.target.value)}>
                        <option value="">Select a category</option>
                        {routes.map(route => (
                            <option key={route} value={route}>{route}</option>
                        ))}
                    </select>
                    {selectedRoute && (
                        <>
                            <textarea
                                rows="20"
                                value={data}
                                onChange={(e) => setData(e.target.value)}
                            />
                            <button onClick={handleSave}>Save</button>
                        </>
                    )}
                </div>
            );
        }

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>